# vcell-batch-job

This project supports the execution of Virtual Cell (VCell) simulations inside a containerized environment using Apptainer (formerly Singularity) on a Linux system hosted via WSL on Windows 10. This setup is tailored for automated, Slurm-based job submissions with structured input/output handling.

---

## üñ•Ô∏è Environment Setup

### 1. Install WSL (Windows Subsystem for Linux)

1. Open **PowerShell as Administrator**.
2. Run:
   ```powershell
   wsl --install -d Ubuntu
   ```
   If you encounter issues:
   ```powershell
   dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   wsl --update
   wsl --install -d Ubuntu
   ```
3. Restart windows when prompted

### 2. Launch Ubuntu

   Open the Ubuntu app from the Windows Start Menu.

   You‚Äôll land in a Linux terminal prompt:
   ```powershell
   vasilescu@oci:~$
   ```
This path maps to your Windows network drive:
   ```powershell
   Z:\  ‚áî  /home/vasilescu
   ```
If the Z: drive is mapped as a network drive, it won't actually be the same location. \
To maintain visibility between File Explorer and Ubuntu's /home/vasilescu, paste \
this in the File Explorer address bar.
```powershell
\\wsl$\Ubuntu\home\vasilescu\vcell-batch-job
```


### 3. Installing Appteiner

1. Update packages and install dependencies
```powershell
sudo apt update && sudo apt install -y \
build-essential wget git cryptsetup runc uidmap squashfs-tools \
fuse-overlayfs libseccomp-dev pkg-config libglib2.0-dev libfuse2
```
2. Download and install Apptainer:
```powershell
export VERSION=1.3.0
wget https://github.com/apptainer/apptainer/releases/download/v${VERSION}/apptainer_${VERSION}_amd64.deb
sudo apt install ./apptainer_${VERSION}_amd64.deb
```
3. Verify installation
   ```powershell
   apptainer version
   ```

### 4. Project directory structure

Root directory: Z:\vcell-batch-job ‚áî /home/vasilescu/vcell-batch-job
```powershell
vcell-batch-job/
‚îú‚îÄ‚îÄ archive/       # Archived or versioned Slurm scripts
‚îú‚îÄ‚îÄ container/     # Apptainer images (e.g., vcell-batch-7.7.0.27.sif)
‚îú‚îÄ‚îÄ input/         # Input files (e.g., .simtask.xml, .langevinInput)
‚îú‚îÄ‚îÄ logs/          # Logs generated by Slurm .slurm.sub scripts
‚îú‚îÄ‚îÄ output/        # Simulation outputs (e.g., solver logs)
‚îú‚îÄ‚îÄ scripts/       # Active Slurm submission scripts and helpers
```
To scaffold this layout run:
```powershell
mkdir -p vcell-batch-job/{archive,container,input,logs,output,scripts}
cp vcell-batch_*.sif vcell-batch-job/container/
```

### 5. Container pulling and versioning.

Set environment variables for GitHub Container Registry access:
```powershell
export APPTAINER_DOCKER_USERNAME=<your_github_username>
export APPTAINER_DOCKER_PASSWORD=<your_github_personal_access_token>
```
Pull the desired container image:
```powershell
apptainer pull vcell-batch-7.7.0.27.sif docker://ghcr.io/virtualcell/vcell-batch:7.7.0.27
```
> All container images are saved under **container/** using versioned filenames
> (e.g., vcell-batch-7.7.0.27.sif, vcell-batch-7.7.0.28.sif)